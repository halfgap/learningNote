<!DOCTYPE html>
<html>
<head>
<title>mysql06</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<h3>课程回顾</h3>
<ol>
<li>一对一： 在从表中添加外键</li>
<li>一对多： 在多的表中添加外键</li>
<li>多对多： 通过新的关系表</li>
<li>权限管理： 三张主表（用户表，角色表，权限表） 两张关系表（用户-角色，角色-权限）</li>
</ol>
<h3>面试题：</h3>
<ul>
<li>
<p>需要保存的信息有： </p>
<p>关系， 红包类型， 红包金额，时间，性别，姓名</p>
</li>
<li>
流水表： id time money type pid 
create table trade(id int primary key auto_increment,time date,money int,type varchar(10),pid int);
</li>
<li>
人物表： id name gender rel 
create table person(id int primary key auto_increment,name varchar(10), gender varchar(4),rel varchar(10));
</li>
<li>
插入人物数据： 人物表，刘德华 男 亲戚 ，杨幂 女 亲戚 ，马云 男 同事，特朗普 男 朋友， 貂蝉 女 朋友
insert into person values(null,'刘德华','男','亲戚'),(null,'杨幂','女','亲戚'),(null,'马云','男','同事'),(null,'特朗普','男','朋友'),(null,'貂蝉','女','朋友');
</li>
<li>
插入流水数据:
刘德华 微信 收1000 2018-03-20
杨幂 现金 收500 发50 2018-04-14
马云 支付宝 收20000 发5 2018-03-11
特朗普 微信 收2000  2018-05-18
貂蝉 微信 发20000 2018-07-22
insert into trade values(null,'2018-03-20',1000,'现金',1),(null,'2018-04-14',500,'现金',2),
(null,'2018-04-14',-50,'现金',2),
(null,'2018-03-11',20000,'支付宝',3),(null,'2018-03-11',-5,'支付宝',3),(null,'2018-05-18',2000,'微信',4),
(null,'2018-07-22',-20000,'微信',5);
</li>
<li>
统计2018年2月15号到现在的所有红包收益
select sum(money) from trade where time&gt;str<em>to</em>date('2018年2月15号','%Y年%c月%d号');
</li>
<li>
查询2018年2月15号到现在 金额大于100 所有女性亲戚的名字和金额
select p.name,t.money
from trade t join person p
on t.pid=p.id
where time&gt;str<em>to</em>date('2018年2月15号','%Y年%c月%d号')
and t.money not between -100 and 100
and p.gender='女'
and p.rel='亲戚';
</li>
<li>
查询三个平台分别收入的红包金额
select type,sum(money) from trade 
where money&gt;0
group by type;
</li>
</ul>
<h3>视图</h3>
<ul>
<li>什么是视图： 数据库中表和视图都是其内部的对象，视图可以理解成一张虚拟的表，视图本质上就是取代了一段SQL查询语句</li>
<li>为什么使用视图： 因为有些数据的查询需要书写大量SQL语句 每次书写浪费时间，使用视图可以起到SQL语句重用的作用,可以隐藏敏感信息</li>
<li>
创建视图格式：
create view 视图名 as 子查询; 创建出来一个虚拟的表
create table 表名 as 子查询; 创建出来一张新表
</li>
<li>
创建一个10号部门员工的视图
create view v<em>emp</em>10 as (select * from emp where deptno=10); 
select * from v<em>emp</em>10;
</li>
<li>
创建每个部门的工资总和，平均工资，最大工资，最小工资的视图
create view v<em>emp</em>info as (select deptno,sum(sal),avg(sal),max(sal),min(sal) from emp group by deptno);
</li>
<li>
创建一个没有工资的员工表视图
create view v<em>emp</em>nosal as (select empno,ename,deptno,hiredate,comm,job from emp);
</li>
</ul>
<h3>视图的分类</h3>
<ol>
<li>简单视图：创建视图的子查询中不包含：去重，函数，分组，关联查询 的视图称为简单视图，简单视图可以对表中数据进行增删改查操作。</li>
<li>复杂视图: 和简单视图相反，复杂视图只能进行查询。</li>
</ol>
<h4>对简单视图进行增删改查   操作方式和table一样</h4>
<ol>
<li>
插入数据
insert into v<em>emp</em>10 (empno,ename) values(10010,'Tom');
</li>
<li>
数据污染：往视图中插入一条视图中不可见，但是原表中存在的数据称为数据污染
insert into v<em>emp</em>10 (empno,ename,deptno) values(10011,'Jerry',10);
</li>
<li>
通过 with check option 解决数据污染问题
create view v<em>emp</em>20 as (select * from emp where deptno=20) with check option;
-测试：
insert into v<em>emp<em>20 (empno,ename) values(10012,'Lucy');报错
insert into v</em>emp</em>20 (empno,ename,deptno) values(10012,'Lucy',20);//成功
</li>
<li>
<p>修改和删除只能操作视图中存在的数据
update v<em>emp</em>10 set sal=10000 where deptno=20;
delete from v<em>emp<em>20 where deptno=10;
delete from v</em>emp</em>20 where empno=10012;</p>
</li>
<li>
<p>修改视图</p>
<p>create or replace view v<em>emp</em>20 as (select * from emp where deptno=20 and sal&gt;2000);</p>
</li>
<li>
删除视图
drop view 视图名;
drop view v<em>emp</em>10;
</li>
<li>
视图别名：如果创建视图的子查询中使用别名，则对视图进行增删改查时只能使用别名
create view v_emp as (select ename name from emp);
此时在视图中只能使用name 使用ename则报错
</li>
</ol>
<h4>视图总结：</h4>
<ol>
<li>视图是数据库中的对象，代表一段sql语句，可以理解成是一个虚拟的表</li>
<li>作用：重用sql，隐藏敏感信息</li>
<li>分类：简单视图(不包含去重，函数，分组，关联查询)和复杂视图(只能进行查询)</li>
<li>插入数据时的数据污染，通过with check option 解决</li>
<li>删除和修改只能操作视图中存在的数据</li>
<li>起了别名后只能用别名</li>
</ol>
<h3>约束</h3>
<ul>
<li>什么是约束： 约束就是给表字段添加限制条件</li>
</ul>
<h4>非空约束 not null</h4>
<ul>
<li>
<p>字段的值不能为null</p>
<p>create table t1(id int,age int not null);
-测试：
insert into t1 values(1,20);//成功
insert into t1 values(2,null);//失败</p>
</li>
</ul>
<h4>唯一约束 unique</h4>
<ul>
<li>
<p>字段的值不能重复</p>
<p>create table t2(id int,age int unique);
-测试：
insert into t2 values(1,20);//成功
insert into t2 values(1,20);//失败</p>
</li>
</ul>
<h4>主键约束 primary key</h4>
<ul>
<li>字段的值唯一且非空</li>
</ul>
<h4>默认约束 default</h4>
<ul>
<li>
<p>给字段设置默认值</p>
<p>create table t3(id int,age int default 20);
-测试：
insert into t3 (id) values (1);//默认值生效
insert into t3 values (2,30);</p>
</li>
</ul>
<h3>外键约束</h3>
<ul>
<li>外键：用来建立关系的字段称为外键</li>
<li>外键约束：添加外键约束的字段，值可以为null，可以重复，但是不能是关联表中不存在的数据，外键指向的数据不能先删除，外键指向的表不能先删除</li>
<li>如何使用外键约束</li>
<li>
创建部门表
create table dept(id int primary key auto_increment,name varchar(10));
</li>
<li>
创建员工表
create table emp(id int primary key auto<em>increment,name varchar(10),deptid int,constraint fk</em>dept foreign key(deptid) references dept(id));
-格式介绍：constraint 约束名称 foreign key(外键字段名) references 表名(字段名)
-插入数据：
insert into dept values(null,'神仙'),(null,'妖怪');
-测试：
insert into emp values(null,'悟空',1);//成功
insert into emp values(null,'赛亚人',3);//失败
delete from dept where id=1;//失败
drop table dept;//失败
drop table emp;//成功
</li>
<li>工作中除非特定场景一般不是用外键约束，因为添加约束后会影响测试效率，一般通过代码建立逻辑外键。</li>
</ul>
<h3>索引</h3>
<p>1805-&gt;mysql-&gt;day06-&gt;day06.zip 解压得到一个  item_backup.sql的文件 千万不要打开</p>
<ul>
<li>
<p>什么是索引：索引是数据库中用来提高查询效率的技术，类似于目录</p>
</li>
<li>
<p>为什么使用索引：如果不使用索引，数据会零散的保存在磁盘块中，查询数据需要挨个遍历每一个磁盘块，直到找到数据为止，使用索引后会将磁盘块以树状结构保存，查询数据时会大大降低访问的磁盘块数量，从而提高查询效率</p>
</li>
</ul>
<h4>索引是越多越好吗？</h4>
<ul>
<li>索引会占用磁盘空间，只对常用的查询字段创建索引</li>
</ul>
<h4>有索引就一定好吗？</h4>
<ul>
<li>如果表中数据量很少，添加索引反而会降低查询效率</li>
</ul>
<h4>导入数据</h4>
<ol>
<li>
<p>学生机  Linux系统 把item_backup.sql文件放到桌面
在终端中执行以下指令：</p>
<pre><code>source /home/soft01/桌面/item_backup.sql;  
</code></pre>

</li>
<li>
<p>window系统 把item_backup.sql文件放到d盘根目录</p>
<pre><code>source d:/item_backup.sql;
</code></pre>

<p>select * from item2 where title='100';//耗时1.15秒</p>
</li>
</ol>
<h4>如何创建索引   name varchar(10)</h4>
<ul>
<li>
<p>格式： create index 索引名 on 表名(字段(字符长度));</p>
<p>create index index<em>item</em>title on item2(title);
select * from item2 where title='100'; //耗时0.02秒</p>
</li>
</ul>
<h4>如何查看索引</h4>
<ul>
<li>show index from item2;</li>
<li>只要是给表添加主键约束，则数据库会为此表自动创建主键字段的索引。</li>
</ul>
<h4>删除索引</h4>
<ul>
<li>
drop index 索引名 on 表名;
drop index index<em>item</em>title on item2;
</li>
</ul>
<h4>复合索引</h4>
<ul>
<li>通过多个字段创建的索引称为复合索引</li>
<li>
格式： create index 索引名 on 表名(字段1,字段2);
create index index<em>item</em>title_price on item2(title,price);
</li>
</ul>
<h4>索引总结：</h4>
<ol>
<li>索引是用来提高查询效率的技术，类似于目录</li>
<li>因为索引会占用磁盘空间所以不是越多越好</li>
<li>因为数据量小的表创建索引会降低查询效率所以不是有索引就一定好</li>
</ol>
<h3>事务</h3>
<ul>
<li>数据库中执行SQL语句的工作单元，保证全部成功或全部失败 </li>
</ul>
<h4>事务的ACID特性</h4>
<ul>
<li>Atomicity： 原子性， 最小不可拆分 全部成功全部失败</li>
<li>Consistency: 一致性， 从一个一致状态到另外一个一致状态 </li>
<li>Isolation： 隔离性， 多个事务之间互不影响 </li>
<li>Durability：持久性，事务完成后数据提交到数据库持久保存 </li>
</ul>
<h4>事务相关SQL</h4>
<ol>
<li>
查看自动提交状态
show variables like '%autocommit%';
</li>
<li>
修改状态
set autocommit=0/1;
</li>
<li>
提交<br />
commit;
</li>
<li>
回滚
rollback;
</li>
<li>
保存回滚点
savepoint s1;
</li>
<li>
回滚到某个回滚点 
rollback to s1;
</li>
</ol>
<h4>group_concat()</h4>
<p>select deptno,group_concat(ename,'-',sal) from emp group by deptno;</p>
<h3>面试题</h3>
<p>有个学生成绩表student， id 主键 name 姓名 subject学科 socre成绩
保存以下数据：
张三 语文 66，张三 数学 77，张三 英语 55，张三 体育 77
李四 语文 59 ，李四 数学 88，李四 英语 78，李四 体育 95
王五 语文 75 ，王五 数学 54，王五 英语 98，王五 体育 88
	create table student(id int primary key auto<em>increment,name varchar(10),subject varchar(5),score int);
	insert into student values(null,'张三','语文',66),(null,'张三','数学',77),(null,'张三','英语',55),(null,'张三','体育',77),(null,'李四','语文',59),(null,'李四','数学',88),(null,'李四','英语',78),(null,'李四','体育',95),(null,'王五','语文',75),(null,'王五','数学',54),(null,'王五','英语',98),(null,'王五','体育',88);
1. 查询每个人的平均分 从大到小排序
	select name,avg(score) a from student group by name order by a desc;
2. 每个人的名称 科目 成绩 一行显示出来
	select name,group</em>concat(subject,'-',score) from student group by name;
3. 查询每个人的最高分和最低分
	select name,max(score),min(score) from student group by name;
4. 查询每个人不及格的科目以及分数 不及格的科目数量
	select name,group_concat(subject,'-',score),count(*) from student where score&lt;60 group by name;</p>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
